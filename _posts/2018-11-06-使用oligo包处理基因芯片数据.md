---
layout: post
title:  "使用oligo包处理基因芯片数据"
category: 'bioinformation'
tags: 基因芯片 oligo limma
author: y570pc
image: 
---

#### 基因芯片数据下载

到GEO官网下载前列腺癌基因芯片数据，包括PCa（GSM1060629、GSM1060630）和PCa bone metastasis（GSM1060627、GSM1060628、GSM1060631、GSM1060632）。下载基因芯片注释文件（GSE43332_family.soft.gz）。

#### 数据预处理

```R
source("https://bioconductor.org/biocLite.R")
biocLite("oligo")
library("oligo")
#文件读取
data.dir <- "F:/ll/GEO/2"
celfiles <- list.files(data.dir, "\\.gz$")
data.raw <- read.celfiles(filenames = file.path(data.dir, celfiles))
#信息修改
treats <- strsplit("PCa_bone_metastasis PCa_bone_metastasis PCa PCa PCa_bone_metastasis PCa_bone_metastasis", " ")[[1]]
snames <- strsplit("PCa_bone_metastasis1 PCa_bone_metastasis2 PCa1 PCa2 PCa_bone_metastasis3 PCa_bone_metastasis4", " ")[[1]]
sampleNames(data.raw) <- snames
pData(data.raw)$index <- treats
#表达量计算
data.eset <- rma(data.raw)  #含背景处理、归一化和表达量计算
data.exprs <- exprs(data.eset)  #提取表达量矩阵
#P/A过滤
xpa <- paCalls(data.raw)
AP <- apply(xpa, 1, function(x) any(x < 0.05))
xids <- as.numeric(names(AP[AP]))
pinfo <- getProbeInfo(data.raw)
#id转换
fids <- pinfo[pinfo$fid %in% xids, 2]  
data.exprs <- data.exprs[rownames(data.exprs) %in% fids, ]
```

#### 获取差异表达探针

```R
library(limma)
#构建试验设计矩阵
design <- model.matrix(~0 + treats)
colnames(design) <- gsub("treats", "", colnames(design))
rownames(design) <- snames
#获取拟合模型
fit1 <- lmFit(data.exprs, design)
#组间比较
contrast.matrix <- makeContrasts("PCa-PCa_bone_metastasis", levels = design)
fit2 <- contrasts.fit(fit1, contrast.matrix)
fit2 <- eBayes(fit2)
#获取表达变化倍数和相关统计值
limma.all <- topTable(fit2, coef = 1, adjust.method = "fdr", number = 3e+05)
limma.fc2 <- topTable(fit2, coef = 1, adjust.method = "fdr", lfc = 1, number = 3e+05)
nrow(limma.fc2)
```

####  探针ID转基因symbol



## 参考资料

[1]. [使用oligo软件包处理芯片数据](https://blog.csdn.net/u014801157/article/details/66974577)

[]. [芯片数据分析步骤3 芯片质量控制-affy](https://blog.csdn.net/tommyhechina/article/details/80335879?utm_source=blogxgwz5)